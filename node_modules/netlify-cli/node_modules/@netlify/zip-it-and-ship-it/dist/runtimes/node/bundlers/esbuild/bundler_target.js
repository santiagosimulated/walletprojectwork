import { DEFAULT_NODE_VERSION, getNodeSupportMatrix, parseVersion } from '../../utils/node_version.js';
import { getClosestPackageJson } from '../../utils/package_json.js';
const versionMap = {
    14: 'node14',
    16: 'node16',
    18: 'node18',
};
const getBundlerTarget = (suppliedVersion) => {
    const version = parseVersion(suppliedVersion);
    if (version && version in versionMap) {
        return versionMap[version];
    }
    return versionMap[DEFAULT_NODE_VERSION];
};
const getModuleFormat = async (srcDir, featureFlags, extension, configVersion) => {
    if (featureFlags.zisi_pure_esm_mjs && extension === ".mjs" /* ModuleFileExtension.MJS */) {
        return {
            includedFiles: [],
            moduleFormat: "esm" /* ModuleFormat.ESM */,
        };
    }
    if (featureFlags.zisi_pure_esm) {
        const packageJsonFile = await getClosestPackageJson(srcDir);
        const nodeSupport = getNodeSupportMatrix(configVersion);
        if (packageJsonFile?.contents.type === 'module' && nodeSupport.esm) {
            return {
                includedFiles: [packageJsonFile.path],
                moduleFormat: "esm" /* ModuleFormat.ESM */,
            };
        }
    }
    return {
        includedFiles: [],
        moduleFormat: "cjs" /* ModuleFormat.COMMONJS */,
    };
};
export { getBundlerTarget, getModuleFormat };
//# sourceMappingURL=bundler_target.js.map